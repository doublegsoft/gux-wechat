'use strict';

var config={yAxisWidth:15,yAxisSplit:5,xAxisHeight:15,xAxisLineHeight:15,legendHeight:15,yAxisTitleWidth:15,padding:12,columePadding:3,fontSize:10,dataPointShape:["diamond","circle","triangle","rect"],colors:["#7cb5ec","#f7a35c","#434348","#90ed7d","#f15c80","#8085e9"],pieChartLinePadding:25,pieChartTextPadding:15,xAxisTextPadding:3,titleColor:"#333333",titleFontSize:20,subtitleColor:"#999999",subtitleFontSize:15,toolTipPadding:3,toolTipBackground:"#000000",toolTipOpacity:.7,toolTipLineHeight:14,radarGridCount:3,radarLabelTextMargin:15};

function assign(r,n){if(null==r)throw new TypeError("Cannot convert undefined or null to object");for(var o=Object(r),t=1;t<arguments.length;t++){var e=arguments[t];if(null!=e)for(var l in e)Object.prototype.hasOwnProperty.call(e,l)&&(o[l]=e[l]);}return o}

var util={toFixed:function(t,n){return n=n||2,this.isFloat(t)&&(t=t.toFixed(n)),t},isFloat:function(t){return t%1!=0},approximatelyEqual:function(t,n){return Math.abs(t-n)<1e-10},isSameSign:function(t,n){return Math.abs(t)===t&&Math.abs(n)===n||Math.abs(t)!==t&&Math.abs(n)!==n},isSameXCoordinateArea:function(t,n){return this.isSameSign(t.x,n.x)},isCollision:function(t,n){return t.end={},t.end.x=t.start.x+t.width,t.end.y=t.start.y-t.height,n.end={},n.end.x=n.start.x+n.width,n.end.y=n.start.y-n.height,!(n.start.x>t.end.x||n.end.x<t.start.x||n.end.y>t.start.y||n.start.y<t.end.y)}};

function findRange(t,r,n){if(isNaN(t))throw new Error("[wxCharts] unvalid series data!");n=n||10,r=r||"upper";for(var e=1;n<1;)n*=10,e*=10;for(t="upper"===r?Math.ceil(t*e):Math.floor(t*e);t%n!=0;)"upper"===r?t++:t--;return t/e}function calValidDistance(t,r,n,e){var a=e.width-n.padding-r.xAxisPoints[0],o=r.eachSpacing*e.categories.length,i=t;return t>=0?i=0:Math.abs(t)>=o-a&&(i=a-o),i}function isInAngleRange(t,r,n){function e(t){for(;t<0;)t+=2*Math.PI;for(;t>2*Math.PI;)t-=2*Math.PI;return t}return t=e(t),(r=e(r))>(n=e(n))&&(n+=2*Math.PI,t<r&&(t+=2*Math.PI)),t>=r&&t<=n}function calRotateTranslate(t,r,n){var e=t,a=n-r,o=e+(n-a-e)/Math.sqrt(2);return {transX:o*=-1,transY:(n-a)*(Math.sqrt(2)-1)-(n-a-e)/Math.sqrt(2)}}function createCurveControlPoints(t,r){function n(t,r){return !(!t[r-1]||!t[r+1])&&(t[r].y>=Math.max(t[r-1].y,t[r+1].y)||t[r].y<=Math.min(t[r-1].y,t[r+1].y))}var e=.2,a=.2,o=null,i=null,u=null,s=null;if(r<1?(o=t[0].x+(t[1].x-t[0].x)*e,i=t[0].y+(t[1].y-t[0].y)*e):(o=t[r].x+(t[r+1].x-t[r-1].x)*e,i=t[r].y+(t[r+1].y-t[r-1].y)*e),r>t.length-3){var l=t.length-1;u=t[l].x-(t[l].x-t[l-1].x)*a,s=t[l].y-(t[l].y-t[l-1].y)*a;}else u=t[r+1].x-(t[r+2].x-t[r].x)*a,s=t[r+1].y-(t[r+2].y-t[r].y)*a;return n(t,r+1)&&(s=t[r+1].y),n(t,r)&&(i=t[r].y),{ctrA:{x:o,y:i},ctrB:{x:u,y:s}}}function convertCoordinateOrigin(t,r,n){return {x:n.x+t,y:n.y-r}}function avoidCollision(t,r){if(r)for(;util.isCollision(t,r);)t.start.x>0?t.start.y--:t.start.x<0||t.start.y>0?t.start.y++:t.start.y--;return t}function fillSeriesColor(t,r){var n=0;return t.map((function(t){return t.color||(t.color=r.colors[n],n=(n+1)%r.colors.length),t}))}function getDataRange(t,r){var n=0,e=r-t;return {minRange:findRange(t,"lower",n=e>=1e4?1e3:e>=1e3?100:e>=100?10:e>=10?5:e>=1?1:e>=.1?.1:.01),maxRange:findRange(r,"upper",n)}}function measureText(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return function(t){t=(t=String(t)).split("");var n=0;return t.forEach((function(t){/[a-zA-Z]/.test(t)?n+=7:/[0-9]/.test(t)?n+=5.5:/\./.test(t)?n+=2.7:/-/.test(t)?n+=3.25:/[\u4e00-\u9fa5]/.test(t)?n+=10:/\(|\)/.test(t)?n+=3.73:/\s/.test(t)?n+=2.5:/%/.test(t)?n+=8:n+=10;})),n*r/10}(t)}

function dataCombine(t){return t.reduce((function(t,a){return (t.data?t.data:t).concat(a.data)}),[])}function getSeriesDataItem(t,a){var n=[];return t.forEach((function(t){if(null!==t.data[a]&&void 0!==t.data[a]){var r={};r.color=t.color,r.name=t.name,r.data=t.format?t.format(t.data[a]):t.data[a],n.push(r);}})),n}function getMaxTextListLength(t){var a=t.map((function(t){return measureText(t)}));return Math.max.apply(null,a)}function getRadarCoordinateSeries(t){for(var a=2*Math.PI/t,n=[],r=0;r<t;r++)n.push(a*r);return n.map((function(t){return -1*t+Math.PI/2}))}function getToolTipData(t,a,n,r){var e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=t.map((function(t){return {text:e.format?e.format(t,r[n]):"".concat(t.name,": ").concat(t.data),color:t.color}})),o=[],u={x:0,y:0};return a.forEach((function(t){void 0!==t[n]&&null!==t[n]&&o.push(t[n]);})),o.forEach((function(t){u.x=Math.round(t.x),u.y+=t.y;})),u.y/=o.length,{textList:i,offset:u}}function findCurrentIndex(t,a,n,r){var e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=-1;return isInExactChartArea(t,n,r)&&a.forEach((function(a,n){t.x+e>a&&(i=n);})),i}function isInExactChartArea(t,a,n){return t.x<a.width-n.padding&&t.x>n.padding+n.yAxisWidth+n.yAxisTitleWidth&&t.y>n.padding&&t.y<a.height-n.legendHeight-n.xAxisHeight-n.padding}function findRadarChartCurrentIndex(t,a,n){var r=2*Math.PI/n,e=-1;if(isInExactPieChartArea(t,a.center,a.radius)){var i=function(t){return t<0&&(t+=2*Math.PI),t>2*Math.PI&&(t-=2*Math.PI),t},o=Math.atan2(a.center.y-t.y,t.x-a.center.x);(o*=-1)<0&&(o+=2*Math.PI),a.angleList.map((function(t){return t=i(-1*t)})).forEach((function(t,a){var n=i(t-r/2),u=i(t+r/2);u<n&&(u+=2*Math.PI),(o>=n&&o<=u||o+2*Math.PI>=n&&o+2*Math.PI<=u)&&(e=a);}));}return e}function findPieChartCurrentIndex(t,a){var n=-1;if(isInExactPieChartArea(t,a.center,a.radius)){var r=Math.atan2(a.center.y-t.y,t.x-a.center.x);r=-r;for(var e=0,i=a.series.length;e<i;e++){var o=a.series[e];if(isInAngleRange(r,o._start_,o._start_+2*o._proportion_*Math.PI)){n=e;break}}}return n}function isInExactPieChartArea(t,a,n){return Math.pow(t.x-a.x,2)+Math.pow(t.y-a.y,2)<=Math.pow(n,2)}function splitPoints(t){var a=[],n=[];return t.forEach((function(t,r){null!==t?n.push(t):(n.length&&a.push(n),n=[]);})),n.length&&a.push(n),a}function calLegendData(t,a,n){if(!1===a.legend)return {legendList:[],legendHeight:0};var r=[],e=0,i=[];return t.forEach((function(t){var n=30+measureText(t.name||"undefined");e+n>a.width?(r.push(i),e=n,i=[t]):(e+=n,i.push(t));})),i.length&&r.push(i),{legendList:r,legendHeight:r.length*(n.fontSize+8)+5}}function calCategoriesData(t,a,n){var r={angle:0,xAxisHeight:n.xAxisHeight},e=getXAxisPoints(t,a,n).eachSpacing,i=t.map((function(t){return measureText(t)})),o=Math.max.apply(this,i);return o+2*n.xAxisTextPadding>e&&(r.angle=45*Math.PI/180,r.xAxisHeight=2*n.xAxisTextPadding+o*Math.sin(r.angle)),r}function getRadarDataPoints(t,a,n,r,e){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=e.extra.radar||{};o.max=o.max||0;var u=Math.max(o.max,Math.max.apply(null,dataCombine(r))),h=[];return r.forEach((function(r){var e={};e.color=r.color,e.data=[],r.data.forEach((function(r,o){var h={};h.angle=t[o],h.proportion=r/u,h.position=convertCoordinateOrigin(n*h.proportion*i*Math.cos(h.angle),n*h.proportion*i*Math.sin(h.angle),a),e.data.push(h);})),h.push(e);})),h}function getPieDataPoints(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0,r=0;return t.forEach((function(t){t.data=null===t.data?0:t.data,n+=t.data;})),t.forEach((function(t){t.data=null===t.data?0:t.data,t._proportion_=t.data/n*a;})),t.forEach((function(t){t._start_=r,r+=2*t._proportion_*Math.PI;})),t}function getPieTextMaxLength(t){t=getPieDataPoints(t);var a=0;return t.forEach((function(t){var n=t.format?t.format(+t._proportion_.toFixed(2)):"".concat(util.toFixed(100*t._proportion_),"%");a=Math.max(a,measureText(n));})),a}function fixColumeData(t,a,n,r,e,i){return t.map((function(t){return null===t?null:(t.width=(a-2*e.columePadding)/n,i.extra.column&&i.extra.column.width&&+i.extra.column.width>0?t.width=Math.min(t.width,+i.extra.column.width):t.width=Math.min(t.width,25),t.x+=(r+.5-n/2)*t.width,t)}))}function getXAxisPoints(t,a,n){var r=n.yAxisWidth+n.yAxisTitleWidth,e=(a.width-2*n.padding-r)/(a.enableScroll?Math.min(5,t.length):t.length),i=[],o=n.padding+r,u=a.width-n.padding;return t.forEach((function(t,a){i.push(o+a*e);})),!0===a.enableScroll?i.push(o+t.length*e):i.push(u),{xAxisPoints:i,startX:o,endX:u,eachSpacing:e}}function getDataPoints(t,a,n,r,e,i,o){var u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,h=[],x=i.height-2*o.padding-o.xAxisHeight-o.legendHeight;return t.forEach((function(t,d){if(null===t)h.push(null);else {var c={};c.x=r[d]+Math.round(e/2);var s=x*(t-a)/(n-a);s*=u,c.y=i.height-o.xAxisHeight-o.legendHeight-Math.round(s)-o.padding,h.push(c);}})),h}function getYAxisTextList(t,a,n){var r=dataCombine(t);r=r.filter((function(t){return null!==t}));var e=Math.min.apply(this,r),i=Math.max.apply(this,r);if("number"==typeof a.yAxis.min&&(e=Math.min(a.yAxis.min,e)),"number"==typeof a.yAxis.max&&(i=Math.max(a.yAxis.max,i)),e===i){var o=i||1;e-=o,i+=o;}for(var u=getDataRange(e,i),h=u.minRange,x=[],d=(u.maxRange-h)/n.yAxisSplit,c=0;c<=n.yAxisSplit;c++)x.push(h+d*c);return x.reverse()}function calYAxisData(t,a,n){var r=getYAxisTextList(t,a,n),e=n.yAxisWidth,i=r.map((function(t){return t=util.toFixed(t,2),t=a.yAxis.format?a.yAxis.format(Number(t)):t,e=Math.max(e,measureText(t)+5),t}));return !0===a.yAxis.disabled&&(e=0),{rangesFormat:i,ranges:r,yAxisWidth:e}}

function drawPointShape(o,e,n,l){l.beginPath(),l.setStrokeStyle("#ffffff"),l.setLineWidth(1),l.setFillStyle(e),"diamond"===n?o.forEach((function(o,e){null!==o&&(l.moveTo(o.x,o.y-4.5),l.lineTo(o.x-4.5,o.y),l.lineTo(o.x,o.y+4.5),l.lineTo(o.x+4.5,o.y),l.lineTo(o.x,o.y-4.5));})):"circle"===n?o.forEach((function(o,e){null!==o&&(l.moveTo(o.x+3.5,o.y),l.arc(o.x,o.y,4,0,2*Math.PI,!1));})):"rect"===n?o.forEach((function(o,e){null!==o&&(l.moveTo(o.x-3.5,o.y-3.5),l.rect(o.x-3.5,o.y-3.5,7,7));})):"triangle"===n&&o.forEach((function(o,e){null!==o&&(l.moveTo(o.x,o.y-4.5),l.lineTo(o.x-4.5,o.y+4.5),l.lineTo(o.x+4.5,o.y+4.5),l.lineTo(o.x,o.y-4.5));})),l.closePath(),l.fill(),l.stroke();}

function drawRingTitle(t,e,i){var o=t.title.fontSize||e.titleFontSize,a=t.subtitle.fontSize||e.subtitleFontSize,r=t.title.name||"",l=t.subtitle.name||"",n=t.title.color||e.titleColor,s=t.subtitle.color||e.subtitleColor,x=r?o:0,h=l?a:0;if(l){var c=measureText(l,a),f=(t.width-c)/2+(t.subtitle.offsetX||0),d=(t.height-e.legendHeight+a)/2;r&&(d-=(x+5)/2),i.beginPath(),i.setFontSize(a),i.setFillStyle(s),i.fillText(l,f,d),i.stroke(),i.closePath();}if(r){var u=measureText(r,o),g=(t.width-u)/2+(t.title.offsetX||0),y=(t.height-e.legendHeight+o)/2;l&&(y+=(h+5)/2),i.beginPath(),i.setFontSize(o),i.setFillStyle(n),i.fillText(r,g,y),i.stroke(),i.closePath();}}function drawPointText(t,e,i,o){var a=e.data;o.beginPath(),o.setFontSize(i.fontSize),o.setFillStyle("#666666"),t.forEach((function(t,i){if(null!==t){var r=e.format?e.format(a[i]):a[i];o.fillText(r,t.x-measureText(r)/2,t.y-2);}})),o.closePath(),o.stroke();}function drawRadarLabel(t,e,i,o,a,r){var l=o.extra.radar||{};e+=a.radarLabelTextMargin,r.beginPath(),r.setFontSize(a.fontSize),r.setFillStyle(l.labelColor||"#666666"),t.forEach((function(t,l){var n={x:e*Math.cos(t),y:e*Math.sin(t)},s=convertCoordinateOrigin(n.x,n.y,i),x=s.x,h=s.y;util.approximatelyEqual(n.x,0)?x-=measureText(o.categories[l]||"")/2:n.x<0&&(x-=measureText(o.categories[l]||"")),r.fillText(o.categories[l]||"",x,h+a.fontSize/2);})),r.stroke(),r.closePath();}function drawPieText(t,e,i,o,a,r){var l=a+i.pieChartLinePadding,n=(i.pieChartTextPadding,[]),s=null;t.map((function(t){return {arc:2*Math.PI-(t._start_+2*Math.PI*t._proportion_/2),text:t.format?t.format(+t._proportion_.toFixed(2)):"".concat(util.toFixed(100*t._proportion_),"%"),color:t.color}})).forEach((function(t){var e=Math.cos(t.arc)*l,o=Math.sin(t.arc)*l,r=Math.cos(t.arc)*a,x=Math.sin(t.arc)*a,h=e>=0?e+i.pieChartTextPadding:e-i.pieChartTextPadding,c=o,f=measureText(t.text),d=c;s&&util.isSameXCoordinateArea(s.start,{x:h})&&(d=h>0?Math.min(c,s.start.y):e<0||c>0?Math.max(c,s.start.y):Math.min(c,s.start.y)),h<0&&(h-=f);var u={lineStart:{x:r,y:x},lineEnd:{x:e,y:o},start:{x:h,y:d},width:f,height:i.fontSize,text:t.text,color:t.color};s=avoidCollision(u,s),n.push(s);})),n.forEach((function(t){var e=convertCoordinateOrigin(t.lineStart.x,t.lineStart.y,r),a=convertCoordinateOrigin(t.lineEnd.x,t.lineEnd.y,r),l=convertCoordinateOrigin(t.start.x,t.start.y,r);o.setLineWidth(1),o.setFontSize(i.fontSize),o.beginPath(),o.setStrokeStyle(t.color),o.setFillStyle(t.color),o.moveTo(e.x,e.y);var n=t.start.x<0?l.x+t.width:l.x,s=t.start.x<0?l.x-5:l.x+5;o.quadraticCurveTo(a.x,a.y,n,l.y),o.moveTo(e.x,e.y),o.stroke(),o.closePath(),o.beginPath(),o.moveTo(l.x+t.width,l.y),o.arc(n,l.y,2,0,2*Math.PI),o.closePath(),o.fill(),o.beginPath(),o.setFillStyle("#666666"),o.fillText(t.text,s,l.y+3),o.closePath(),o.stroke(),o.closePath();}));}

function drawToolTipSplitLine(o,i,t,e){var l=t.padding,n=i.height-t.padding-t.xAxisHeight-t.legendHeight;e.beginPath(),e.setStrokeStyle("#cccccc"),e.setLineWidth(1),e.moveTo(o,l),e.lineTo(o,n),e.stroke(),e.closePath();}function drawToolTip(o,i,t,e,l){var n=!1;(i=assign({x:0,y:0},i)).y-=8;var a=o.map((function(o){return measureText(o.text)})),p=9+4*e.toolTipPadding+Math.max.apply(null,a),T=2*e.toolTipPadding+o.length*e.toolTipLineHeight;i.x-Math.abs(t._scrollDistance_)+8+p>t.width&&(n=!0),l.beginPath(),l.setFillStyle(t.tooltip.option.background||e.toolTipBackground),l.setGlobalAlpha(e.toolTipOpacity),n?(l.moveTo(i.x,i.y+10),l.lineTo(i.x-8,i.y+10-5),l.lineTo(i.x-8,i.y+10+5),l.moveTo(i.x,i.y+10),l.fillRect(i.x-p-8,i.y,p,T)):(l.moveTo(i.x,i.y+10),l.lineTo(i.x+8,i.y+10-5),l.lineTo(i.x+8,i.y+10+5),l.moveTo(i.x,i.y+10),l.fillRect(i.x+8,i.y,p,T)),l.closePath(),l.fill(),l.setGlobalAlpha(1),o.forEach((function(o,t){l.beginPath(),l.setFillStyle(o.color);var a=i.x+8+2*e.toolTipPadding,T=i.y+(e.toolTipLineHeight-e.fontSize)/2+e.toolTipLineHeight*t+e.toolTipPadding;n&&(a=i.x-p-8+2*e.toolTipPadding),l.fillRect(a,T,4,e.fontSize),l.closePath();})),l.beginPath(),l.setFontSize(e.fontSize),l.setFillStyle("#ffffff"),o.forEach((function(o,t){var a=i.x+8+2*e.toolTipPadding+4+5;n&&(a=i.x-p-8+2*e.toolTipPadding+4+5);var T=i.y+(e.toolTipLineHeight-e.fontSize)/2+e.toolTipLineHeight*t+e.toolTipPadding;l.fillText(o.text,a,T+e.fontSize);})),l.stroke(),l.closePath();}

function drawYAxisTitle(t,e,i,a){var o=i.xAxisHeight+(e.height-i.xAxisHeight-measureText(t))/2;a.save(),a.beginPath(),a.fontSize=i.fontSize,a.fillStyle=e.yAxis.titleFontColor||"#333333",a.translate(0,e.height),a.rotate(-90*Math.PI/180),a.fillText(t,o,i.padding+.5*i.fontSize),a.stroke(),a.closePath(),a.restore();}function drawColumnDataPoints(t,e,i,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,n=calYAxisData(t,e,i).ranges,r=getXAxisPoints(e.categories,e,i),l=r.xAxisPoints,s=r.eachSpacing,c=n.pop(),h=n.shift();e.height,i.padding,i.xAxisHeight,i.legendHeight;return a.save(),e._scrollDistance_&&0!==e._scrollDistance_&&!0===e.enableScroll&&a.translate(e._scrollDistance_,0),t.forEach((function(n,r){var d=n.data,f=getDataPoints(d,c,h,l,s,e,i,o);f=fixColumeData(f,s,t.length,r,i,e),a.beginPath(),a.fillStyle=n.color,f.forEach((function(t,o){if(null!==t){var n=t.x-t.width/2+1,r=e.height-t.y-i.padding-i.xAxisHeight-i.legendHeight;a.moveTo(n,t.y),a.rect(n,t.y,t.width-2,r);}})),a.closePath(),a.fill();})),t.forEach((function(n,r){var d=n.data,f=getDataPoints(d,c,h,l,s,e,i,o);f=fixColumeData(f,s,t.length,r,i,e),!1!==e.dataLabel&&1===o&&drawPointText(f,n,i,a);})),a.restore(),{xAxisPoints:l,eachSpacing:s}}function drawAreaDataPoints(t,e,i,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,n=calYAxisData(t,e,i).ranges,r=getXAxisPoints(e.categories,e,i),l=r.xAxisPoints,s=r.eachSpacing,c=n.pop(),h=n.shift(),d=e.height-i.padding-i.xAxisHeight-i.legendHeight,f=[];return a.save(),e._scrollDistance_&&0!==e._scrollDistance_&&!0===e.enableScroll&&a.translate(e._scrollDistance_,0),e.tooltip&&e.tooltip.textList&&e.tooltip.textList.length&&1===o&&drawToolTipSplitLine(e.tooltip.offset.x,e,i,a),t.forEach((function(t,n){var r=t.data,x=getDataPoints(r,c,h,l,s,e,i,o);if(f.push(x),splitPoints(x).forEach((function(i){if(a.beginPath(),a.strokeStyle=t.color,a.fillStyle=t.color,a.setGlobalAlpha(.6),a.lineWidth=2,i.length>1){var o=i[0],n=i[i.length-1];a.moveTo(o.x,o.y),"curve"===e.extra.lineStyle?i.forEach((function(t,e){if(e>0){var o=createCurveControlPoints(i,e-1);a.bezierCurveTo(o.ctrA.x,o.ctrA.y,o.ctrB.x,o.ctrB.y,t.x,t.y);}})):i.forEach((function(t,e){e>0&&a.lineTo(t.x,t.y);})),a.lineTo(n.x,d),a.lineTo(o.x,d),a.lineTo(o.x,o.y);}else {var r=i[0];a.moveTo(r.x-s/2,r.y),a.lineTo(r.x+s/2,r.y),a.lineTo(r.x+s/2,d),a.lineTo(r.x-s/2,d),a.moveTo(r.x-s/2,r.y);}a.closePath(),a.fill(),a.setGlobalAlpha(1);})),!1!==e.dataPointShape){var g=i.dataPointShape[n%i.dataPointShape.length];drawPointShape(x,t.color,g,a);}})),!1!==e.dataLabel&&1===o&&t.forEach((function(t,n){var r=t.data,d=getDataPoints(r,c,h,l,s,e,i,o);drawPointText(d,t,i,a);})),a.restore(),{xAxisPoints:l,calPoints:f,eachSpacing:s}}function drawLineDataPoints(t,e,i,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,n=calYAxisData(t,e,i).ranges,r=getXAxisPoints(e.categories,e,i),l=r.xAxisPoints,s=r.eachSpacing,c=n.pop(),h=n.shift(),d=[];return a.save(),e._scrollDistance_&&0!==e._scrollDistance_&&!0===e.enableScroll&&a.translate(e._scrollDistance_,0),e.tooltip&&e.tooltip.textList&&e.tooltip.textList.length&&1===o&&drawToolTipSplitLine(e.tooltip.offset.x,e,i,a),t.forEach((function(t,n){var r=t.data,f=getDataPoints(r,c,h,l,s,e,i,o);if(d.push(f),splitPoints(f).forEach((function(i,o){a.beginPath(),a.strokeStyle=t.color,a.lineWidth=2,1===i.length?(a.moveTo(i[0].x,i[0].y),a.arc(i[0].x,i[0].y,1,0,2*Math.PI)):(a.moveTo(i[0].x,i[0].y),"curve"===e.extra.lineStyle?i.forEach((function(t,e){if(e>0){var o=createCurveControlPoints(i,e-1);a.bezierCurveTo(o.ctrA.x,o.ctrA.y,o.ctrB.x,o.ctrB.y,t.x,t.y);}})):i.forEach((function(t,e){e>0&&a.lineTo(t.x,t.y);})),a.moveTo(i[0].x,i[0].y)),a.closePath(),a.stroke();})),!1!==e.dataPointShape){var x=i.dataPointShape[n%i.dataPointShape.length];drawPointShape(f,t.color,x,a);}})),!1!==e.dataLabel&&1===o&&t.forEach((function(t,n){var r=t.data,d=getDataPoints(r,c,h,l,s,e,i,o);drawPointText(d,t,i,a);})),a.restore(),{xAxisPoints:l,calPoints:d,eachSpacing:s}}function drawToolTipBridge(t,e,i,a){i.save(),t._scrollDistance_&&0!==t._scrollDistance_&&!0===t.enableScroll&&i.translate(t._scrollDistance_,0),t.tooltip&&t.tooltip.textList&&t.tooltip.textList.length&&1===a&&drawToolTip(t.tooltip.textList,t.tooltip.offset,t,e,i),i.restore();}function drawXAxis(t,e,i,a){var o=getXAxisPoints(t,e,i),n=o.xAxisPoints,r=(o.eachSpacing),l=e.height-i.padding-i.xAxisHeight-i.legendHeight,s=l+i.xAxisLineHeight;a.save(),e._scrollDistance_&&0!==e._scrollDistance_&&a.translate(e._scrollDistance_,0),a.beginPath(),a.strokeStyle=e.xAxis.gridColor||"#cccccc",!0!==e.xAxis.disableGrid&&("calibration"===e.xAxis.type?n.forEach((function(t,e){e>0&&(a.moveTo(t-r/2,l),a.lineTo(t-r/2,l+4));})):n.forEach((function(t,e){a.moveTo(t,l),a.lineTo(t,s);}))),a.closePath(),a.stroke();var c=e.width-2*i.padding-i.yAxisWidth-i.yAxisTitleWidth,h=Math.min(t.length,Math.ceil(c/i.fontSize/1.5)),d=Math.ceil(t.length/h);t=t.map((function(t,e){return e%d!=0?"":t})),0===i._xAxisTextAngle_?(a.beginPath(),a.fontSize=i.fontSize,a.fillStyle=e.xAxis.fontColor||"#666666",t.forEach((function(t,e){var o=r/2-measureText(t)/2;a.fillText(t,n[e]+o,l+i.fontSize+5);})),a.closePath(),a.stroke()):t.forEach((function(t,o){a.save(),a.beginPath(),a.fontSize=i.fontSize,a.fillStyle=e.xAxis.fontColor||"#666666";var s=measureText(t),c=r/2-s,h=calRotateTranslate(n[o]+r/2,l+i.fontSize/2+5,e.height),d=h.transX,f=h.transY;a.rotate(-1*i._xAxisTextAngle_),a.translate(d,f),a.fillText(t,n[o]+c,l+i.fontSize+5),a.closePath(),a.stroke(),a.restore();})),a.restore();}function drawYAxisGrid(t,e,i){for(var a=t.height-2*e.padding-e.xAxisHeight-e.legendHeight,o=Math.floor(a/e.yAxisSplit),n=e.yAxisWidth+e.yAxisTitleWidth,r=e.padding+n,l=t.width-e.padding,s=[],c=0;c<e.yAxisSplit;c++)s.push(e.padding+o*c);s.push(e.padding+o*e.yAxisSplit+2),i.beginPath(),i.strokeStyle=t.yAxis.gridColor||"#cccccc",i.lineWidth=1,s.forEach((function(t,e){i.moveTo(r,t),i.lineTo(l,t);})),i.closePath(),i.stroke();}function drawYAxis(t,e,i,a){if(!0!==e.yAxis.disabled){var o=calYAxisData(t,e,i).rangesFormat,n=i.yAxisWidth+i.yAxisTitleWidth,r=e.height-2*i.padding-i.xAxisHeight-i.legendHeight,l=Math.floor(r/i.yAxisSplit),s=i.padding+n,c=e.width-i.padding,h=(i.padding,e.height-i.padding-i.xAxisHeight-i.legendHeight);a.fillStyle=e.background||"#ffffff",e._scrollDistance_<0&&a.fillRect(0,0,s,h+i.xAxisHeight+5),a.fillRect(c,0,e.width,h+i.xAxisHeight+5);for(var d=[],f=0;f<=i.yAxisSplit;f++)d.push(i.padding+l*f);a.stroke(),a.beginPath(),a.fontSize=i.fontSize,a.fillStyle=e.yAxis.fontColor||"#666666",o.forEach((function(t,e){var o=d[e]?d[e]:h;a.fillText(t,i.padding+i.yAxisTitleWidth,o+i.fontSize/2);})),a.closePath(),a.stroke(),e.yAxis.title&&drawYAxisTitle(e.yAxis.title,e,i,a);}}function drawLegend(t,e,i,a){if(e.legend){var o=calLegendData(t,e,i),n=o.legendList;o.legendHeight;n.forEach((function(t,o){var n=0;t.forEach((function(t){t.name=t.name||"undefined",n+=15+measureText(t.name)+15;}));var r=(e.width-n)/2+5,l=e.height-i.padding-i.legendHeight+o*(i.fontSize+8)+5+8;a.fontSize=i.fontSize,t.forEach((function(t){switch(e.type){case"line":a.beginPath(),a.lineWidth=1,a.strokeStyle=t.color,a.moveTo(r-2,l+5),a.lineTo(r+17,l+5),a.stroke(),a.closePath(),a.beginPath(),a.lineWidth=1,a.strokeStyle="#ffffff",a.fillStyle=t.color,a.moveTo(r+7.5,l+5),a.arc(r+7.5,l+5,4,0,2*Math.PI),a.fill(),a.stroke(),a.closePath();break;case"pie":case"ring":a.beginPath(),a.fillStyle=t.color,a.moveTo(r+7.5,l+5),a.arc(r+7.5,l+5,7,0,2*Math.PI),a.closePath(),a.fill();break;default:a.beginPath(),a.fillStyle=t.color,a.moveTo(r,l),a.rect(r,l,15,10),a.closePath(),a.fill();}r+=20,a.beginPath(),a.fillStyle=e.extra.legendTextColor||"#333333",a.fillText(t.name,r,l+9),a.closePath(),a.stroke(),r+=measureText(t.name)+10;}));}));}}function drawPieDataPoints(t,e,i,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,n=e.extra.pie||{};t=getPieDataPoints(t,o);var r={x:e.width/2,y:(e.height-i.legendHeight)/2},l=Math.min(r.x-i.pieChartLinePadding-i.pieChartTextPadding-i._pieTextMaxLength_,r.y-i.pieChartLinePadding-i.pieChartTextPadding);if(e.dataLabel?l-=10:l-=2*i.padding,(t=t.map((function(t){return t._start_+=(n.offsetAngle||0)*Math.PI/180,t}))).forEach((function(t){a.beginPath(),a.lineWidth=2,a.strokeStyle="#ffffff",a.fillStyle=t.color,a.moveTo(r.x,r.y),a.arc(r.x,r.y,l,t._start_,t._start_+2*t._proportion_*Math.PI),a.closePath(),a.fill(),!0!==e.disablePieStroke&&a.stroke();})),"ring"===e.type){var s=.6*l;"number"==typeof e.extra.ringWidth&&e.extra.ringWidth>0&&(s=Math.max(0,l-e.extra.ringWidth)),a.beginPath(),a.fillStyle=e.background||"#ffffff",a.moveTo(r.x,r.y),a.arc(r.x,r.y,s,0,2*Math.PI),a.closePath(),a.fill();}if(!1!==e.dataLabel&&1===o){for(var c=!1,h=0,d=t.length;h<d;h++)if(t[h].data>0){c=!0;break}c&&drawPieText(t,e,i,a,l,r);}return 1===o&&"ring"===e.type&&drawRingTitle(e,i,a),{center:r,radius:l,series:t}}function drawRadarDataPoints(t,e,i,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,n=e.extra.radar||{},r=getRadarCoordinateSeries(e.categories.length),l={x:e.width/2,y:(e.height-i.legendHeight)/2},s=Math.min(l.x-(getMaxTextListLength(e.categories)+i.radarLabelTextMargin),l.y-i.radarLabelTextMargin);s-=i.padding,a.beginPath(),a.lineWidth=1,a.strokeStyle=n.gridColor||"#cccccc",r.forEach((function(t){var e=convertCoordinateOrigin(s*Math.cos(t),s*Math.sin(t),l);a.moveTo(l.x,l.y),a.lineTo(e.x,e.y);})),a.stroke(),a.closePath();for(var c=function(t){var e={};a.beginPath(),a.lineWidth=1,a.strokeStyle=n.gridColor||"#cccccc",r.forEach((function(o,n){var r=convertCoordinateOrigin(s/i.radarGridCount*t*Math.cos(o),s/i.radarGridCount*t*Math.sin(o),l);0===n?(e=r,a.moveTo(r.x,r.y)):a.lineTo(r.x,r.y);})),a.lineTo(e.x,e.y),a.stroke(),a.closePath();},h=1;h<=i.radarGridCount;h++)c(h);return getRadarDataPoints(r,l,s,t,e,o).forEach((function(t,o){if(a.beginPath(),a.fillStyle=t.color,a.setGlobalAlpha(.6),t.data.forEach((function(t,e){0===e?a.moveTo(t.position.x,t.position.y):a.lineTo(t.position.x,t.position.y);})),a.closePath(),a.fill(),a.setGlobalAlpha(1),!1!==e.dataPointShape){var n=i.dataPointShape[o%i.dataPointShape.length],r=t.data.map((function(t){return t.position}));drawPointShape(r,t.color,n,a);}})),drawRadarLabel(r,s,l,e,i,a),{center:l,radius:s,angleList:r}}

var Timing = {easeIn:function(t){return Math.pow(t,3)},easeOut:function(t){return Math.pow(t-1,3)+1},easeInOut:function(t){return (t/=.5)<1?.5*Math.pow(t,3):.5*(Math.pow(t-2,3)+2)},linear:function(t){return t}};

function Animation(i){this.isStop=!1,i.duration=void 0===i.duration?1e3:i.duration,i.timing=i.timing||"linear";var n="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setTimeout?function(i,n){setTimeout((function(){var n=+new Date;i(n);}),n);}:function(i){i(null);},o=null,t=function(e){if(null===e||!0===this.isStop)return i.onProcess&&i.onProcess(1),void(i.onAnimationFinish&&i.onAnimationFinish());if(null===o&&(o=e),e-o<i.duration){var s=(e-o)/i.duration;s=(0, Timing[i.timing])(s),i.onProcess&&i.onProcess(s),n(t,17);}else i.onProcess&&i.onProcess(1),i.onAnimationFinish&&i.onAnimationFinish();};t=t.bind(this),n(t,17);}Animation.prototype.stop=function(){this.isStop=!0;};

function drawCharts(a,i,t,n){var e=this,r=i.series,s=i.categories;r=fillSeriesColor(r,t);var o=calLegendData(r,i,t).legendHeight;t.legendHeight=o;var d=calYAxisData(r,i,t).yAxisWidth;if(t.yAxisWidth=d,s&&s.length){var c=calCategoriesData(s,i,t),h=c.xAxisHeight,g=c.angle;t.xAxisHeight=h,t._xAxisTextAngle_=g;}"pie"!==a&&"ring"!==a||(t._pieTextMaxLength_=!1===i.dataLabel?0:getPieTextMaxLength(r));var w=i.animation?1e3:0;switch(this.animationInstance&&this.animationInstance.stop(),a){case"line":this.animationInstance=new Animation({timing:"easeIn",duration:w,onProcess:function(a){n.clearRect(0,0,i.width,i.height),drawYAxisGrid(i,t,n);var o=drawLineDataPoints(r,i,t,n,a),d=o.xAxisPoints,c=o.calPoints,h=o.eachSpacing;e.chartData.xAxisPoints=d,e.chartData.calPoints=c,e.chartData.eachSpacing=h,drawXAxis(s,i,t,n),drawLegend(i.series,i,t,n),drawYAxis(r,i,t,n),drawToolTipBridge(i,t,n,a);},onAnimationFinish:function(){e.event.trigger("renderComplete");}});break;case"column":this.animationInstance=new Animation({timing:"easeIn",duration:w,onProcess:function(a){n.clearRect(0,0,i.width,i.height),drawYAxisGrid(i,t,n);var o=drawColumnDataPoints(r,i,t,n,a),d=o.xAxisPoints,c=o.eachSpacing;e.chartData.xAxisPoints=d,e.chartData.eachSpacing=c,drawXAxis(s,i,t,n),drawLegend(i.series,i,t,n),drawYAxis(r,i,t,n);},onAnimationFinish:function(){e.event.trigger("renderComplete");}});break;case"area":this.animationInstance=new Animation({timing:"easeIn",duration:w,onProcess:function(a){n.clearRect(0,0,i.width,i.height),drawYAxisGrid(i,t,n);var o=drawAreaDataPoints(r,i,t,n,a),d=o.xAxisPoints,c=o.calPoints,h=o.eachSpacing;e.chartData.xAxisPoints=d,e.chartData.calPoints=c,e.chartData.eachSpacing=h,drawXAxis(s,i,t,n),drawLegend(i.series,i,t,n),drawYAxis(r,i,t,n),drawToolTipBridge(i,t,n,a);},onAnimationFinish:function(){e.event.trigger("renderComplete");}});break;case"ring":case"pie":this.animationInstance=new Animation({timing:"easeInOut",duration:w,onProcess:function(a){n.clearRect(0,0,i.width,i.height),e.chartData.pieData=drawPieDataPoints(r,i,t,n,a),drawLegend(i.series,i,t,n);},onAnimationFinish:function(){e.event.trigger("renderComplete");}});break;case"radar":this.animationInstance=new Animation({timing:"easeInOut",duration:w,onProcess:function(a){n.clearRect(0,0,i.width,i.height),e.chartData.radarData=drawRadarDataPoints(r,i,t,n,a),drawLegend(i.series,i,t,n);},onAnimationFinish:function(){e.event.trigger("renderComplete");}});}}

function Event(){this.events={};}Event.prototype.addEventListener=function(t,e){this.events[t]=this.events[t]||[],this.events[t].push(e);},Event.prototype.trigger=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e[0],s=e.slice(1);this.events[r]&&this.events[r].forEach((function(t){try{t.apply(null,s);}catch(t){console.error(t);}}));};

var Charts=function(t){t.title=t.title||{},t.subtitle=t.subtitle||{},t.yAxis=t.yAxis||{},t.xAxis=t.xAxis||{},t.extra=t.extra||{},t.legend=!1!==t.legend,t.animation=!1!==t.animation;var i=assign({},config);i.yAxisTitleWidth=!0!==t.yAxis.disabled&&t.yAxis.title?i.yAxisTitleWidth:0,i.pieChartLinePadding=!1===t.dataLabel?0:i.pieChartLinePadding,i.pieChartTextPadding=!1===t.dataLabel?0:i.pieChartTextPadding,this.opts=t,this.config=i,this.context=t.context,this.chartData={},this.event=new Event,this.scrollOption={currentOffset:0,startTouchX:0,distance:0},drawCharts.call(this,t.type,t,i,this.context);};Charts.prototype.updateData=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.opts.series=t.series||this.opts.series,this.opts.categories=t.categories||this.opts.categories,this.opts.title=assign({},this.opts.title,t.title||{}),this.opts.subtitle=assign({},this.opts.subtitle,t.subtitle||{}),drawCharts.call(this,this.opts.type,this.opts,this.config,this.context);},Charts.prototype.stopAnimation=function(){this.animationInstance&&this.animationInstance.stop();},Charts.prototype.addEventListener=function(t,i){this.event.addEventListener(t,i);},Charts.prototype.getCurrentDataIndex=function(t){var i=t.touches&&t.touches.length?t.touches:t.changedTouches;if(i&&i.length){var s=i[0],e=s.x,a=s.y;return "pie"===this.opts.type||"ring"===this.opts.type?findPieChartCurrentIndex({x:e,y:a},this.chartData.pieData):"radar"===this.opts.type?findRadarChartCurrentIndex({x:e,y:a},this.chartData.radarData,this.opts.categories.length):findCurrentIndex({x:e,y:a},this.chartData.xAxisPoints,this.opts,this.config,Math.abs(this.scrollOption.currentOffset))}return -1},Charts.prototype.showToolTip=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("line"===this.opts.type||"area"===this.opts.type){var s=this.getCurrentDataIndex(t),e=this.scrollOption.currentOffset,a=assign({},this.opts,{_scrollDistance_:e,animation:!1});if(s>-1){var o=getSeriesDataItem(this.opts.series,s);if(0!==o.length){var r=getToolTipData(o,this.chartData.calPoints,s,this.opts.categories,i),n=r.textList,h=r.offset;a.tooltip={textList:n,offset:h,option:i};}}drawCharts.call(this,a.type,a,this.config,this.context);}},Charts.prototype.scrollStart=function(t){t.touches[0]&&!0===this.opts.enableScroll&&(this.scrollOption.startTouchX=t.touches[0].x);},Charts.prototype.scroll=function(t){if(t.touches[0]&&!0===this.opts.enableScroll){var i=t.touches[0].x-this.scrollOption.startTouchX,s=this.scrollOption.currentOffset,e=calValidDistance(s+i,this.chartData,this.config,this.opts);this.scrollOption.distance=i=e-s;var a=assign({},this.opts,{_scrollDistance_:s+i,animation:!1});drawCharts.call(this,a.type,a,this.config,this.context);}},Charts.prototype.scrollEnd=function(t){if(!0===this.opts.enableScroll){var i=this.scrollOption,s=i.currentOffset,e=i.distance;this.scrollOption.currentOffset=s+e,this.scrollOption.distance=0;}};

module.exports = Charts;
